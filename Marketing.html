<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>StockFlow | Marketing Automation</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#6366F1',
                        secondary: '#8B5CF6',
                        bgLight: '#F3F4F6',
                        success: '#10B981',
                        danger: '#EF4444'
                    },
                    animation: {
                        'fade-in': 'fadeIn 0.5s ease-out',
                        'slide-up': 'slideUp 0.4s ease-out'
                    },
                    keyframes: {
                        fadeIn: { '0%': { opacity: '0' }, '100%': { opacity: '1' } },
                        slideUp: { '0%': { transform: 'translateY(20px)', opacity: '0' }, '100%': { transform: 'translateY(0)', opacity: '1' } }
                    }
                }
            }
        }
    </script>
    <style>
        body { font-family: 'Inter', sans-serif; }
        .toggle-checkbox:checked {
            right: 0;
            border-color: #68D391;
        }
        .toggle-checkbox:checked + .toggle-label {
            background-color: #68D391;
        }
    </style>
</head>
<body class="bg-bgLight h-screen overflow-hidden flex text-gray-800">

    <div id="toast-container" class="fixed top-5 right-5 z-50 flex flex-col gap-2"></div>

    <aside class="w-20 bg-white border-r border-gray-200 flex flex-col items-center py-6 z-20 shadow-lg flex-shrink-0">
        <div class="w-10 h-10 bg-gradient-to-br from-primary to-secondary rounded-lg flex items-center justify-center text-white font-bold mb-8 shadow-md">S</div>
        <nav class="flex-1 space-y-4 w-full flex flex-col items-center">
            <a href="Dashboard.html" class="text-gray-400 hover:text-primary hover:bg-indigo-50 p-3 rounded-xl transition-all" title="Dashboard">
                <i class="fas fa-chart-pie text-xl"></i>
            </a>
            <a href="POS.html" class="text-gray-400 hover:text-primary hover:bg-indigo-50 p-3 rounded-xl transition-all" title="POS">
                <i class="fas fa-cash-register text-xl"></i>
            </a>
            <a href="Inventario.html" class="text-gray-400 hover:text-primary hover:bg-indigo-50 p-3 rounded-xl transition-all" title="Inventario">
                <i class="fas fa-boxes text-xl"></i>
            </a>
            <a href="Clientes.html" class="text-gray-400 hover:text-primary hover:bg-indigo-50 p-3 rounded-xl transition-all" title="Clientes">
                <i class="fas fa-users text-xl"></i>
            </a>
            <a href="Marketing.html" class="text-primary bg-blue-50 p-3 rounded-xl transition shadow-inner relative group" title="Marketing">
                <i class="fas fa-bullhorn text-x1"></i>
                <span class="absolute right-2 top-2 w-2 h-2 bg-success rounded-full ring-2 ring-white"></span>
            </a>
        </nav>
        <button onclick="logout()" class="text-gray-400 hover:text-danger mt-auto p-3 rounded-xl hover:bg-red-50 transition">
            <i class="fas fa-power-off text-xl"></i>
        </button>
    </aside>

    <main class="flex-1 flex flex-col h-full overflow-y-auto p-4 md:p-8 custom-scroll">
        
        <div class="flex flex-col md:flex-row justify-between items-end mb-8 gap-4 animate-fade-in">
            <div>
                <h1 class="text-3xl font-bold text-gray-900 tracking-tight">Marketing Automation</h1>
                <p class="text-gray-500 mt-1">Convierte inventario estancado en efectivo automáticamente.</p>
            </div>
            <button onclick="openModal()" class="bg-gradient-to-r from-primary to-secondary text-white px-6 py-3 rounded-xl font-bold shadow-lg shadow-indigo-200 hover:shadow-xl transition transform hover:-translate-y-1 active:scale-95 flex items-center gap-2">
                <i class="fas fa-magic"></i> Crear Nueva Campaña
            </button>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8 animate-slide-up" style="animation-delay: 0.1s;">
            <div class="bg-white p-6 rounded-2xl shadow-sm border border-gray-100 relative overflow-hidden group hover:shadow-md transition">
                <div class="absolute right-0 top-0 p-4 opacity-10 group-hover:opacity-20 transition">
                    <i class="fas fa-chart-line text-6xl text-green-500"></i>
                </div>
                <p class="text-gray-500 text-xs uppercase font-bold tracking-wider">Retorno de Inversión (ROI)</p>
                <h3 class="text-3xl font-bold text-gray-800 mt-2" id="roi-counter">0%</h3>
                <p class="text-xs text-green-600 mt-2 font-medium bg-green-50 inline-block px-2 py-1 rounded"><i class="fas fa-arrow-up"></i> S/ 4.50 ganados / sol invertido</p>
            </div>
            
            <div class="bg-white p-6 rounded-2xl shadow-sm border border-gray-100 relative overflow-hidden group hover:shadow-md transition">
                <div class="absolute right-0 top-0 p-4 opacity-10 group-hover:opacity-20 transition">
                    <i class="fas fa-envelope-open-text text-6xl text-blue-500"></i>
                </div>
                <p class="text-gray-500 text-xs uppercase font-bold tracking-wider">Tasa de Apertura</p>
                <h3 class="text-3xl font-bold text-gray-800 mt-2" id="open-rate-counter">0%</h3>
                <p class="text-xs text-gray-400 mt-2">Promedio industria: 18%</p>
            </div>
            
            <div class="bg-white p-6 rounded-2xl shadow-sm border border-gray-100 relative overflow-hidden group hover:shadow-md transition">
                <div class="absolute right-0 top-0 p-4 opacity-10 group-hover:opacity-20 transition">
                    <i class="fas fa-shopping-bag text-6xl text-purple-500"></i>
                </div>
                <p class="text-gray-500 text-xs uppercase font-bold tracking-wider">Ventas Atribuidas</p>
                <h3 class="text-3xl font-bold text-gray-800 mt-2" id="sales-counter">S/ 0.00</h3>
                <p class="text-xs text-gray-400 mt-2">Últimos 30 días</p>
            </div>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 animate-slide-up" style="animation-delay: 0.2s;">
            
            <div class="space-y-6">
                <h2 class="font-bold text-lg text-gray-700 flex items-center gap-2">
                    <i class="fas fa-bolt text-yellow-500"></i> Campañas Activas
                </h2>

                <div class="bg-white rounded-2xl p-6 shadow-sm border border-gray-200 relative overflow-hidden group transition hover:border-green-200">
                    <div class="flex justify-between items-start z-10 relative">
                        <div class="flex items-center gap-4">
                            <div class="w-12 h-12 bg-green-100 rounded-xl flex items-center justify-center text-green-600 text-xl shadow-sm">
                                <i class="fab fa-whatsapp"></i>
                            </div>
                            <div>
                                <h3 class="font-bold text-gray-800 text-lg">Liquidación Verano</h3>
                                <p class="text-xs text-gray-500 font-medium">WhatsApp • 150 Destinatarios</p>
                            </div>
                        </div>
                        <span class="bg-green-100 text-green-700 text-xs px-3 py-1 rounded-full font-bold border border-green-200 animate-pulse">En Curso</span>
                    </div>
                    
                    <div class="mt-6">
                        <div class="flex justify-between text-xs text-gray-500 mb-1">
                            <span>Progreso de envío</span>
                            <span class="font-bold text-gray-700">70%</span>
                        </div>
                        <div class="bg-gray-100 rounded-full h-2.5 w-full overflow-hidden">
                            <div class="bg-gradient-to-r from-green-400 to-green-600 h-full rounded-full w-[0%]" style="transition: width 1.5s ease-out;" id="progress-bar-1"></div>
                        </div>
                    </div>
                    
                    <div class="mt-4 flex gap-4 border-t border-gray-50 pt-4">
                        <div class="text-center">
                            <p class="text-xs text-gray-400 uppercase font-bold">Clics</p>
                            <p class="font-bold text-gray-800">85</p>
                        </div>
                        <div class="text-center border-l border-gray-100 pl-4">
                            <p class="text-xs text-gray-400 uppercase font-bold">Ventas</p>
                            <p class="font-bold text-gray-800">12</p>
                        </div>
                    </div>
                </div>

                <div class="bg-white rounded-2xl p-6 shadow-sm border border-gray-200 relative overflow-hidden group hover:border-blue-200 transition">
                    <div class="flex justify-between items-start">
                        <div class="flex items-center gap-4">
                            <div class="w-12 h-12 bg-blue-100 rounded-xl flex items-center justify-center text-blue-600 text-xl shadow-sm">
                                <i class="fas fa-envelope"></i>
                            </div>
                            <div>
                                <h3 class="font-bold text-gray-800 text-lg">Newsletter Semanal</h3>
                                <p class="text-xs text-gray-500 font-medium">Email • Clientes VIP</p>
                            </div>
                        </div>
                        <span class="bg-gray-100 text-gray-600 text-xs px-3 py-1 rounded-full font-bold border border-gray-200">Programada</span>
                    </div>
                    <div class="mt-4 bg-blue-50 p-3 rounded-lg border border-blue-100 flex items-center gap-2 text-sm text-blue-700">
                        <i class="far fa-clock"></i> Se envía mañana a las 9:00 AM
                    </div>
                </div>
            </div>

            <div class="bg-white rounded-2xl shadow-sm border border-gray-200 p-6 h-fit">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="font-bold text-lg text-gray-700">Reglas Automáticas</h2>
                    <button onclick="showToast('Funcionalidad disponible en Plan Enterprise', 'info')" class="text-primary text-sm font-bold hover:underline">+ Nueva Regla</button>
                </div>

                <div class="space-y-4">
                    
                    <div class="border border-gray-200 rounded-xl p-4 hover:border-primary transition bg-white shadow-sm">
                        <div class="flex items-center justify-between mb-2">
                            <div class="flex items-center gap-2">
                                <span class="bg-indigo-100 text-primary text-[10px] font-bold px-2 py-1 rounded uppercase">Trigger: Stock</span>
                                <i class="fas fa-arrow-right text-gray-300 text-xs"></i>
                                <span class="bg-purple-100 text-purple-600 text-[10px] font-bold px-2 py-1 rounded uppercase">Action: Email</span>
                            </div>
                            <div class="relative inline-block w-10 mr-2 align-middle select-none transition duration-200 ease-in">
                                <input type="checkbox" name="toggle" id="toggle1" class="toggle-checkbox absolute block w-5 h-5 rounded-full bg-white border-4 appearance-none cursor-pointer transition-all duration-300 left-0 border-gray-300 checked:left-5 checked:border-success" checked onclick="toggleRule(1)"/>
                                <label for="toggle1" class="toggle-label block overflow-hidden h-5 rounded-full bg-gray-300 cursor-pointer transition-colors duration-300 checked:bg-success"></label>
                            </div>
                        </div>
                        <p class="text-sm font-medium text-gray-800 leading-relaxed">
                            SI <span class="font-bold bg-gray-100 px-1 rounded text-xs">Stock > 100</span> Y <span class="font-bold bg-gray-100 px-1 rounded text-xs">Sin ventas > 30 días</span>
                        </p>
                        <p class="text-sm text-gray-500 mt-1">
                            ENTONCES <span class="text-primary font-medium">Enviar cupón 20% a interesados.</span>
                        </p>
                        <p id="status-text-1" class="text-xs text-green-500 font-bold mt-2 flex items-center gap-1"><i class="fas fa-circle text-[8px]"></i> Activa</p>
                    </div>

                    <div class="border border-gray-200 rounded-xl p-4 hover:border-primary transition bg-gray-50 opacity-80" id="rule-card-2">
                        <div class="flex items-center justify-between mb-2">
                            <div class="flex items-center gap-2">
                                <span class="bg-yellow-100 text-yellow-700 text-[10px] font-bold px-2 py-1 rounded uppercase">Trigger: Fecha</span>
                                <i class="fas fa-arrow-right text-gray-300 text-xs"></i>
                                <span class="bg-green-100 text-green-600 text-[10px] font-bold px-2 py-1 rounded uppercase">Action: WhatsApp</span>
                            </div>
                            <div class="relative inline-block w-10 mr-2 align-middle select-none transition duration-200 ease-in">
                                <input type="checkbox" name="toggle" id="toggle2" class="toggle-checkbox absolute block w-5 h-5 rounded-full bg-white border-4 appearance-none cursor-pointer transition-all duration-300 left-0 border-gray-300 checked:left-5 checked:border-success" onclick="toggleRule(2)"/>
                                <label for="toggle2" class="toggle-label block overflow-hidden h-5 rounded-full bg-gray-300 cursor-pointer transition-colors duration-300 checked:bg-success"></label>
                            </div>
                        </div>
                        <p class="text-sm font-medium text-gray-800">
                            SI <span class="font-bold bg-white border border-gray-200 px-1 rounded text-xs">Es cumpleaños del cliente</span>
                        </p>
                        <p class="text-sm text-gray-500 mt-1">
                            ENTONCES <span class="text-primary font-medium">Enviar saludo + Regalo sorpresa.</span>
                        </p>
                        <p id="status-text-2" class="text-xs text-gray-400 font-bold mt-2 flex items-center gap-1"><i class="fas fa-pause-circle text-[10px]"></i> Pausada</p>
                    </div>

                </div>
            </div>
        </div>
    </main>

    <div id="campaignModal" class="fixed inset-0 z-50 hidden" aria-labelledby="modal-title" role="dialog" aria-modal="true">
        <div class="fixed inset-0 bg-gray-900 bg-opacity-75 transition-opacity backdrop-blur-sm" onclick="closeModal()"></div>
        <div class="flex min-h-full items-center justify-center p-4 text-center sm:p-0">
            <div class="relative transform overflow-hidden rounded-2xl bg-white text-left shadow-2xl transition-all sm:my-8 sm:w-full sm:max-w-lg animate-slide-up">
                <div class="bg-white px-4 pb-4 pt-5 sm:p-6 sm:pb-4 border-b border-gray-100">
                    <h3 class="text-xl font-bold leading-6 text-gray-900">Crear Campaña</h3>
                    <p class="text-sm text-gray-500 mt-1">Configura los detalles de tu nuevo envío masivo.</p>
                </div>
                <form onsubmit="createCampaign(event)" class="p-6 space-y-4">
                    <div>
                        <label class="block text-sm font-bold text-gray-700 mb-1">Nombre de la Campaña</label>
                        <input type="text" required placeholder="Ej: Oferta Fin de Mes" class="w-full px-4 py-2 border border-gray-300 rounded-xl focus:ring-2 focus:ring-primary focus:border-primary outline-none transition">
                    </div>
                    
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-bold text-gray-700 mb-1">Canal</label>
                            <select class="w-full px-4 py-2 border border-gray-300 rounded-xl focus:ring-2 focus:ring-primary outline-none bg-white">
                                <option value="whatsapp">WhatsApp</option>
                                <option value="email">Email Marketing</option>
                                <option value="sms">SMS</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-bold text-gray-700 mb-1">Segmento</label>
                            <select class="w-full px-4 py-2 border border-gray-300 rounded-xl focus:ring-2 focus:ring-primary outline-none bg-white">
                                <option value="all">Todos los Clientes</option>
                                <option value="vip">Clientes VIP</option>
                                <option value="inactive">Inactivos (>30 días)</option>
                                <option value="debtors">Deudores</option>
                            </select>
                        </div>
                    </div>

                    <div>
                        <label class="block text-sm font-bold text-gray-700 mb-1">Contenido del Mensaje</label>
                        <textarea rows="3" required placeholder="Hola {nombre}, aprovecha nuestros descuentos..." class="w-full px-4 py-2 border border-gray-300 rounded-xl focus:ring-2 focus:ring-primary outline-none transition resize-none"></textarea>
                        <p class="text-xs text-gray-400 mt-1 text-right">0 / 160 caracteres</p>
                    </div>

                    <div class="pt-2 flex flex-row-reverse gap-3">
                        <button type="submit" class="w-full justify-center rounded-xl bg-primary px-3 py-3 text-sm font-bold text-white shadow-md hover:bg-secondary hover:shadow-lg transition transform active:scale-95">Lanzar Campaña</button>
                        <button type="button" onclick="closeModal()" class="w-full justify-center rounded-xl bg-white px-3 py-3 text-sm font-bold text-gray-700 shadow-sm ring-1 ring-inset ring-gray-300 hover:bg-gray-50 transition">Cancelar</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <script>
        // 1. INICIALIZACIÓN
        document.addEventListener('DOMContentLoaded', () => {
            checkAuth();
            animateKPIs();
            
            // Animar barra de progreso con delay
            setTimeout(() => {
                document.getElementById('progress-bar-1').style.width = '70%';
            }, 500);
        });

        function checkAuth() {
            if (!localStorage.getItem('stockflow_session')) window.location.href = 'Login.html';
        }

        // 2. ANIMACIÓN DE NÚMEROS (KPIs)
        function animateKPIs() {
            animateValue("roi-counter", 0, 450, 2000, "%");
            animateValue("open-rate-counter", 0, 32.5, 2000, "%");
            animateValue("sales-counter", 0, 1205, 2000, "S/ ");
        }

        function animateValue(id, start, end, duration, prefix = "") {
            const obj = document.getElementById(id);
            let startTimestamp = null;
            const step = (timestamp) => {
                if (!startTimestamp) startTimestamp = timestamp;
                const progress = Math.min((timestamp - startTimestamp) / duration, 1);
                const value = progress * (end - start) + start;
                
                if(prefix === "S/ ") {
                    obj.innerHTML = `${prefix}${value.toLocaleString('es-PE', {minimumFractionDigits: 2, maximumFractionDigits: 2})}`;
                } else {
                    obj.innerHTML = `${value.toFixed(1)}${prefix}`;
                }

                if (progress < 1) {
                    window.requestAnimationFrame(step);
                }
            };
            window.requestAnimationFrame(step);
        }

        // 3. INTERACCIÓN DE REGLAS (TOGGLES)
        function toggleRule(id) {
            const checkbox = document.getElementById(`toggle${id}`);
            const statusText = document.getElementById(`status-text-${id}`);
            const card = id === 2 ? document.getElementById('rule-card-2') : null;

            if (checkbox.checked) {
                statusText.innerHTML = `<i class="fas fa-circle text-[8px]"></i> Activa`;
                statusText.className = "text-xs text-green-500 font-bold mt-2 flex items-center gap-1";
                if(card) {
                    card.classList.remove('bg-gray-50', 'opacity-80');
                    card.classList.add('bg-white');
                }
                showToast("Regla de automatización activada");
            } else {
                statusText.innerHTML = `<i class="fas fa-pause-circle text-[10px]"></i> Pausada`;
                statusText.className = "text-xs text-gray-400 font-bold mt-2 flex items-center gap-1";
                if(card) {
                    card.classList.add('bg-gray-50', 'opacity-80');
                    card.classList.remove('bg-white');
                }
                showToast("Regla pausada", "info");
            }
        }

        // 4. MODAL Y CREACIÓN
        function openModal() {
            document.getElementById('campaignModal').classList.remove('hidden');
        }

        function closeModal() {
            document.getElementById('campaignModal').classList.add('hidden');
        }

        function createCampaign(e) {
            e.preventDefault();
            closeModal();
            
            // Simulación de carga
            showToast("Procesando audiencia...", "info");
            
            setTimeout(() => {
                showToast("¡Campaña lanzada con éxito!", "success");
                // Aquí podríamos añadir lógica para insertar la campaña en el DOM dinámicamente
            }, 1500);
        }

        // 5. UTILIDADES
        function showToast(message, type = 'success') {
            const container = document.getElementById('toast-container');
            const toast = document.createElement('div');
            const bgClass = type === 'success' ? 'bg-green-500' : (type === 'info' ? 'bg-blue-500' : 'bg-gray-800');
            const icon = type === 'success' ? 'fa-check-circle' : 'fa-info-circle';
            
            toast.className = `${bgClass} text-white px-4 py-3 rounded-xl shadow-lg flex items-center gap-3 animate-fade-in mb-2 z-50`;
            toast.innerHTML = `<i class="fas ${icon}"></i> <span>${message}</span>`;
            container.appendChild(toast);
            setTimeout(() => toast.remove(), 3000);
        }

        function logout() {
            if(confirm('¿Cerrar sesión?')) {
                localStorage.removeItem('stockflow_session');
                window.location.href = 'Login.html';
            }
        }
    </script>
</body>
</html>